/*
@Author:        hogan.chen@ymail.com
@Create Date:   2020-11-11
*/

package main

import (
	"fmt"
	"time"

	"github.com/buger/jsonparser"
	"github.com/tidwall/gjson"
	"github.com/valyala/fastjson"
)

func jsonRead() {
	jsonString := `{"rc":0,"rt":6,"svr":182993539,"lt":1,"full":1,"data":{"total":4699,"diff":[{"f1":2,"f2":17.64,"f3":-1.29,"f4":-0.23,"f5":843543,"f6":1497625216.0,"f7":2.24,"f8":0.43,"f9":8.81,"f10":0.94,"f11":-0.06,"f12":"000001","f13":0,"f14":"平安银行","f15":18.0,"f16":17.6,"f17":17.85,"f18":17.87,"f20":342320397013,"f21":342317508939,"f22":0.17,"f23":1.07,"f24":-0.95,"f25":-7.93,"f62":-441800648.0,"f115":9.6,"f128":"-","f140":"-","f141":"-","f136":"-","f152":2},{"f1":2,"f2":17.83,"f3":-1.27,"f4":-0.23,"f5":473818,"f6":846989376.0,"f7":1.22,"f8":0.49,"f9":9.32,"f10":0.44,"f11":-0.11,"f12":"000002","f13":0,"f14":"万  科Ａ","f15":18.0,"f16":17.78,"f17":18.0,"f18":18.06,"f20":207280585576,"f21":173263974715,"f22":-0.17,"f23":0.91,"f24":-7.62,"f25":-35.05,"f62":38379157.0,"f115":5.41,"f128":"-","f140":"-","f141":"-","f136":"-","f152":2},{"f1":2,"f2":"-","f3":"-","f4":"-","f5":"-","f6":"-","f7":"-","f8":"-","f9":"-","f10":"-","f11":"-","f12":"000003","f13":0,"f14":"PT金田A","f15":"-","f16":"-","f17":"-","f18":2.71,"f20":"-","f21":"-","f22":"-","f23":"-","f24":"-","f25":"-","f62":"-","f115":"-","f128":"-","f140":"-","f141":"-","f136":"-","f152":2},{"f1":2,"f2":17.25,"f3":2.68,"f4":0.45,"f5":24770,"f6":42422508.0,"f7":4.11,"f8":2.13,"f9":59.82,"f10":1.79,"f11":-0.29,"f12":"000004","f13":0,"f14":"国华网安","f15":17.39,"f16":16.7,"f17":16.8,"f18":16.8,"f20":2691052199,"f21":2006705662,"f22":-0.17,"f23":1.81,"f24":-26.72,"f25":-16.67,"f62":2732246.0,"f115":65.77,"f128":"-","f140":"-","f141":"-","f136":"-","f152":2},{"f1":2,"f2":2.09,"f3":0.0,"f4":0.0,"f5":65736,"f6":13703797.0,"f7":2.39,"f8":0.62,"f9":8.54,"f10":0.82,"f11":0.0,"f12":"000005","f13":0,"f14":"ST星源","f15":2.11,"f16":2.06,"f17":2.08,"f18":2.09,"f20":2212342000,"f21":2211107646,"f22":0.0,"f23":1.54,"f24":1.95,"f25":-17.39,"f62":-212246.0,"f115":-13.36,"f128":"-","f140":"-","f141":"-","f136":"-","f152":2},{"f1":2,"f2":4.08,"f3":-0.97,"f4":-0.04,"f5":27751,"f6":11346100.0,"f7":1.21,"f8":0.21,"f9":7.35,"f10":0.85,"f11":0.0,"f12":"000006","f13":0,"f14":"深振业Ａ","f15":4.12,"f16":4.07,"f17":4.1,"f18":4.12,"f20":5507979788,"f21":5507979788,"f22":-0.24,"f23":0.72,"f24":-8.72,"f25":-24.72,"f62":317536.0,"f115":6.01,"f128":"-","f140":"-","f141":"-","f136":"-","f152":2},{"f1":2,"f2":4.94,"f3":-3.33,"f4":-0.17,"f5":146571,"f6":72966885.0,"f7":5.87,"f8":4.74,"f9":-555.2,"f10":1.51,"f11":0.41,"f12":"000007","f13":0,"f14":"*ST全新","f15":5.15,"f16":4.85,"f17":5.05,"f18":5.11,"f20":1711453337,"f21":1526203337,"f22":0.41,"f23":27.53,"f24":22.28,"f25":-29.12,"f62":-11155503.0,"f115":-21.47,"f128":"-","f140":"-","f141":"-","f136":"-","f152":2},{"f1":2,"f2":2.12,"f3":0.47,"f4":0.01,"f5":98852,"f6":20940034.0,"f7":1.42,"f8":0.37,"f9":-44.86,"f10":1.07,"f11":0.47,"f12":"000008","f13":0,"f14":"神州高铁","f15":2.13,"f16":2.1,"f17":2.1,"f18":2.11,"f20":5895286134,"f21":5710819455,"f22":0.47,"f23":0.91,"f24":1.92,"f25":-16.54,"f62":265833.0,"f115":-7.85,"f128":"-","f140":"-","f141":"-","f136":"-","f152":2},{"f1":2,"f2":18.7,"f3":-5.03,"f4":-0.99,"f5":1011407,"f6":1921289312.0,"f7":6.7,"f8":3.96,"f9":40.53,"f10":1.02,"f11":0.48,"f12":"000009","f13":0,"f14":"中国宝安","f15":19.75,"f16":18.43,"f17":19.5,"f18":19.69,"f20":48231301146,"f21":47711747059,"f22":0.43,"f23":6.22,"f24":-17.77,"f25":149.33,"f62":-222518502.0,"f115":46.7,"f128":"-","f140":"-","f141":"-","f136":"-","f152":2},{"f1":2,"f2":3.87,"f3":-1.02,"f4":-0.04,"f5":34681,"f6":13452262.0,"f7":1.79,"f8":0.66,"f9":109.93,"f10":0.74,"f11":-0.26,"f12":"000010","f13":0,"f14":"美丽生态","f15":3.92,"f16":3.85,"f17":3.91,"f18":3.91,"f20":3172837739,"f21":2020803697,"f22":0.0,"f23":6.16,"f24":-1.02,"f25":-1.02,"f62":-3843287.0,"f115":89.46,"f128":"-","f140":"-","f141":"-","f136":"-","f152":2},{"f1":2,"f2":10.4,"f3":-1.42,"f4":-0.15,"f5":26687,"f6":27838845.0,"f7":1.52,"f8":0.51,"f9":6.0,"f10":0.69,"f11":0.0,"f12":"000011","f13":0,"f14":"深物业A","f15":10.54,"f16":10.38,"f17":10.54,"f18":10.55,"f20":6198182557,"f21":5475345647,"f22":0.0,"f23":1.46,"f24":-9.88,"f25":-11.56,"f62":-753674.0,"f115":4.49,"f128":"-","f140":"-","f141":"-","f136":"-","f152":2},{"f1":2,"f2":8.53,"f3":-3.83,"f4":-0.34,"f5":284468,"f6":246261285.0,"f7":3.95,"f8":1.45,"f9":13.01,"f10":0.99,"f11":0.0,"f12":"000012","f13":0,"f14":"南  玻Ａ","f15":8.85,"f16":8.5,"f17":8.83,"f18":8.87,"f20":26193003673,"f21":16692280878,"f22":0.0,"f23":2.29,"f24":-28.14,"f25":17.17,"f62":-59458607.0,"f115":16.77,"f128":"-","f140":"-","f141":"-","f136":"-","f152":2},{"f1":2,"f2":"-","f3":"-","f4":"-","f5":"-","f6":"-","f7":"-","f8":"-","f9":"-","f10":"-","f11":"-","f12":"000013","f13":0,"f14":"*ST石化A","f15":"-","f16":"-","f17":"-","f18":2.47,"f20":"-","f21":"-","f22":"-","f23":"-","f24":"-","f25":"-","f62":"-","f115":"-","f128":"-","f140":"-","f141":"-","f136":"-","f152":2},{"f1":2,"f2":6.91,"f3":-0.14,"f4":-0.01,"f5":6398,"f6":4414969.0,"f7":1.73,"f8":0.32,"f9":-33.55,"f10":0.84,"f11":0.0,"f12":"000014","f13":0,"f14":"沙河股份","f15":6.94,"f16":6.82,"f17":6.93,"f18":6.92,"f20":1393782842,"f21":1393782842,"f22":-0.14,"f23":1.62,"f24":0.0,"f25":-16.44,"f62":-507613.0,"f115":-34.32,"f128":"-","f140":"-","f141":"-","f136":"-","f152":2},{"f1":2,"f2":"-","f3":"-","f4":"-","f5":"-","f6":"-","f7":"-","f8":"-","f9":"-","f10":"-","f11":"-","f12":"000015","f13":0,"f14":"PT中浩A","f15":"-","f16":"-","f17":"-","f18":6.85,"f20":"-","f21":"-","f22":"-","f23":"-","f24":"-","f25":"-","f62":"-","f115":"-","f128":"-","f140":"-","f141":"-","f136":"-","f152":2},{"f1":2,"f2":5.85,"f3":2.45,"f4":0.14,"f5":110773,"f6":64254380.0,"f7":4.2,"f8":0.69,"f9":-83.6,"f10":1.72,"f11":-0.17,"f12":"000016","f13":0,"f14":"深康佳Ａ","f15":5.9,"f16":5.66,"f17":5.71,"f18":5.71,"f20":14086480637,"f21":9339959655,"f22":0.0,"f23":1.75,"f24":-7.0,"f25":-10.14,"f62":6089382.0,"f115":-53.34,"f128":"-","f140":"-","f141":"-","f136":"-","f152":2},{"f1":2,"f2":3.28,"f3":0.61,"f4":0.02,"f5":32275,"f6":10436285.0,"f7":4.29,"f8":1.07,"f9":698.67,"f10":2.18,"f11":-0.3,"f12":"000017","f13":0,"f14":"深中华A","f15":3.3,"f16":3.16,"f17":3.26,"f18":3.26,"f20":1808421266,"f21":993777706,"f22":0.0,"f23":140.77,"f24":-23.0,"f25":36.1,"f62":154326.0,"f115":3898.28,"f128":"-","f140":"-","f141":"-","f136":"-","f152":2},{"f1":2,"f2":"-","f3":"-","f4":"-","f5":"-","f6":"-","f7":"-","f8":"-","f9":"-","f10":"-","f11":"-","f12":"000018","f13":0,"f14":"神城A退","f15":"-","f16":"-","f17":"-","f18":0.27,"f20":"-","f21":"-","f22":"-","f23":"-","f24":"-","f25":"-","f62":"-","f115":"-","f128":"-","f140":"-","f141":"-","f136":"-","f152":2},{"f1":2,"f2":6.86,"f3":-2.14,"f4":-0.15,"f5":66164,"f6":45732675.0,"f7":2.85,"f8":1.59,"f9":19.97,"f10":0.73,"f11":-0.15,"f12":"000019","f13":0,"f14":"深粮控股","f15":7.04,"f16":6.84,"f17":7.02,"f18":7.01,"f20":7906391842,"f21":2855027948,"f22":0.0,"f23":1.76,"f24":-4.59,"f25":-6.03,"f62":-5822143.0,"f115":20.19,"f128":"-","f140":"-","f141":"-","f136":"-","f152":2},{"f1":2,"f2":8.63,"f3":0.47,"f4":0.04,"f5":2030,"f6":1742472.0,"f7":1.28,"f8":0.11,"f9":224.49,"f10":0.65,"f11":0.0,"f12":"000020","f13":0,"f14":"深华发Ａ","f15":8.63,"f16":8.52,"f17":8.55,"f18":8.59,"f20":2443681389,"f21":1563457324,"f22":0.0,"f23":7.07,"f24":-10.85,"f25":-13.61,"f62":155660.0,"f115":240.92,"f128":"-","f140":"-","f141":"-","f136":"-","f152":2}]}}`

	var p fastjson.Parser

	v, _ := p.Parse(jsonString)

	fmt.Printf("v: %v\n", v)
	fmt.Printf("data: %v\n", v.GetStringBytes("data"))
	fmt.Printf("data: %v\n", fastjson.GetString([]byte(jsonString), "data", "diff"))

	fmt.Printf("diff: %v\n", gjson.Get(jsonString, "data.diff.#"))

	value, _ := jsonparser.GetString([]byte(jsonString), "data", "diff", "[0]")
	fmt.Printf("value: %v\n", value)
}

func gjsonRead() {
	jsonString := `[{"symbol":"sh600069","code":"600069","name":"退市银鸽","trade":"0.280","pricechange":0,"changepercent":0,"buy":"0.000","sell":"0.000","settlement":"0.280","open":"0.000","high":"0.000","low":"0.000","volume":0,"amount":0,"ticktime":"09:00:00","per":-0.712,"pb":0.377,"mktcap":45467.347632,"nmc":45467.347632,"turnoverratio":0},{"symbol":"sh600071","code":"600071","name":"凤凰光学","trade":"54.760","pricechange":-0.44,"changepercent":-0.797,"buy":"54.760","sell":"54.770","settlement":"55.200","open":"54.350","high":"55.770","low":"53.700","volume":4014136,"amount":218692734,"ticktime":"10:45:20","per":1095.2,"pb":29.651,"mktcap":1541898.616164,"nmc":1300399.169056,"turnoverratio":1.69036},{"symbol":"sh600078","code":"600078","name":"*ST澄星","trade":"8.050","pricechange":0.38,"changepercent":4.954,"buy":"8.050","sell":"0.000","settlement":"7.670","open":"8.040","high":"8.050","low":"7.810","volume":23735656,"amount":190759284,"ticktime":"10:45:21","per":-2.41,"pb":-13.932,"mktcap":533371.153105,"nmc":533371.153105,"turnoverratio":3.58235}]`
	fmt.Printf("len: %v\n", gjson.Get(jsonString, "#"))
	fmt.Printf("item: %v\n", gjson.Get(jsonString, "0"))
}

func main() {
	start := time.Now()
	fmt.Printf("Program start execution at %s\n\n", start.Format("2006-01-02 15:04:05"))

	jsonRead()
	gjsonRead()

	elapsed := time.Since(start)
	fmt.Printf("\nProgram end execution at %s\n", time.Now().Format("2006-01-02 15:04:05"))
	fmt.Printf("Total elapsed time: %s\n", elapsed)
}
